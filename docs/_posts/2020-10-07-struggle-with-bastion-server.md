---
title: 踏み台サーバを捨てる努力をする
date: 2020-10-07T06:45:57.627Z
slug: struggle-with-bastion-server
---
## Bastion

昔から踏み台（Bastion）サーバという物が苦手で必用がなければ無いくらいでいいと思ってる

というのは踏み台というのはナイーブなソリューションであって本質的には必用ないものだと思ってるからだ

結局はセキュリティ上のリスクと利便性とのトレードオフというところはあるが、他のソリューションに比べリスクと利便性とのトレードオフで若干リスクの方が高い

リスク＞利便性である限りリスクを低減する施策を取る必用はあるが、そのために必用なコストは得てして我々は過小評価してしまい、次第に運用コストの増大とセキュリティリスクの増加の曲線が利便性の曲線を追い越してしまう

![画像]()

### 踏み台を使ったオペレーション

プロジェクトにおいていわゆるインフラのオペレーションが必用になるのは

- 構成変更
- インシデント調査
- クエリ実行

でありどれも本質的にBastionのようなインターフェースが必用ではなく、オペレーションの実行とインフラのマネージメントを切り離せるものだ

#### 構成変更

まず構成変更に関してはAWSのインフラはAPIで全て変更なため本質的にはほとんどのケースでBastionは要らない

またコンテナの一般への利用の広がりやk8sのような状態をAPIでコントロールするIaCの文脈でサーバに入って何かを行うというようなオペレーションはアンチパターンになってきており、むしろ避けるべきものになってきている。何かしらの状態をサーバに保持するということは、その状態を再現可能なコードを書かない限りサーバが滅失すると状態を再現不可になってしまうからだ

コンテナによるImmutable Infrastructureが必用なのは状態を持ったサーバは冪等性が確保できないからであり秘伝のタレでの人手の暖かみのあるデプロイがDevとOpsの距離を遠くしてしまう

#### インシデント調査

インシデント調査に関しても監査ログ、クエリログ、エラーログ、フローログ、パケットログなど外部ストレージに保存しておけば基本的にそれ以上調査するべきところはない。というよりはそうするべきといった方が正確かもしれない。ログは発生と同時に外部ストレージに保存するべきでログが発生した主体と同一の記憶領域に置くのは常に滅失リスクと改ざんリスクが存在する。

#### クエリ実行

クエリ実行に関してはAurora Serverlessの[クエリエディタ](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/query-editor.html)のように任意のクエリをRDSのWebコンソールで実行出来るソリューションも既にあり、十分優れたWeb UIとセキュリティ、モニタリングが確保出来ればWebで問題ない

本質的にはクエリというInputと→クエリ結果というOutputを出力出来ることが要件でありCLIを使うのは一つの手段に過ぎない

### なぜ我々はまだ踏み台から逃れられないのか

それでも2020年にもなってまだ踏み台が必用とされるのはナイーブだが誰にでもで簡単に実行出来るソリューションというのはある

しかし隠されたセキュリティ上のコストを無視は出来ない


